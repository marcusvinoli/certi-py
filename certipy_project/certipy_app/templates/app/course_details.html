{% extends 'app_base.html' %}
{% block title %} 
	Cursos | #{{course.id}} - {{course.title}}
{% endblock %}

{% block actions %}

{% endblock %}

{% block app_slot %}
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
	/* $.ajaxSetup({
  	data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
	}); */

	$(document).ready(function() {
			$(".delete-button").click(function() {
					var objId = $(this).data("id");
					var csrftoken = $("[name=csrfmiddlewaretoken]").val();

					// Confirme com o usuário antes de excluir
					var confirmDelete = confirm("Tem certeza de que deseja excluir este curso?");

					if (confirmDelete) {
							$.ajax({
									url: '/courses/' + objId,
									method: 'DELETE',
									headers: {
										"X-CSRFToken": csrftoken
									},
									success: function(data) {
										console.log("Deleted.")
										window.location.href = "/courses"
									},
									error: function(error) {
										console.error("Erro ao excluir item:", JSON.stringify(error));
									}
							});
					}
			});
	});
</script>
<div class="grow flex flex-col">
	<div class="mx-2 mt-2">
		<h1 class="font-bold text-xl">Informações do Curso</h1>
	</div>
	<div class="mx-2 mt-2 bg-blue-100 rounded-lg">
		<form novalidate="" action="{% url 'Curso' course_id=course.id %}" method="PATCH" class="container flex flex-col mx-auto space-y-12">
			<fieldset class="grid grid-cols-3 gap-6 p-4">
				<!-- <div class="space-y-2 col-span-full lg:col-span-1">
					<p class="font-medium">Novo Curso</p>
					<p class="text-xs">Crie um novo curso para adicionar alunos</p>
				</div> -->
				<div class="grid grid-cols-6 gap-4 col-span-full lg:col-span-3">
					<div class="col-span-full">
						<label for="title" class="text-sm">Título do Curso</label>
						<input value="{{course.title}}" id="title" name="title" type="text" class="w-full p-2 rounded-md focus:ring focus:ri text-gray-900 border-gray-300 focus:ri" required>
					</div>
					<div class="col-span-full sm:col-span-2">
						<label for="teacher" class="text-sm">Ministrado por</label>
						<input value="{{course.teacher}}" id="teacher" name="teacher" type="text" class="w-full p-2 rounded-md focus:ring focus:ri text-gray-900 border-gray-300 focus:ri" required>
					</div>
					<div class="col-span-full sm:col-span-2">
						<label for="workload" class="text-sm">Carga Horária (h)</label>
						<input value="{{course.workload}}" id="workload" name="workload" type="number" class="w-full p-2 rounded-md focus:ring focus:ri text-gray-900 border-gray-300 focus:ri" required>
					</div>
					<div class="col-span-full sm:col-span-2">
						<label for="date" class="text-sm">Data de Conclusão</label>
						<input value="{{course.date | date:"Y-m-d"}}" id="date" name="date" type="date" class="w-full p-2 rounded-md focus:ring focus:ri text-gray-900 border-gray-300 focus:ri" required>
					</div>
					{% csrf_token %}
					<div class="col-span-full">
						<button data-id="{{ course.id }}" class="delete-button px-8 py-3 font-semibold rounded bg-red-800 text-red-100">Excluir Curso</button>
						<button type="submit" class="px-8 py-3 font-semibold rounded bg-gray-800 text-gray-100">Salvar Alterações</button>
					</div>
				</div>
			</fieldset>
		</form>
	</div>
	<div class="mx-2 mt-2">
		<h1 class="font-bold text-xl">Alunos Matriculados</h1>
	</div>
	<div class="relative grow mt-1 mb-1 mx-2 bg-blue-100 rounded-lg">
		<div class="absolute top-0 left-0 bottom-0 w-full overflow-auto flex flex-row gap-2 py-2 flex-wrap space-between">
			<form novalidate="" action="{% url 'Curso' course_id=course.id %}" method="POST" class="container flex flex-col mx-auto space-y-12">
				<fieldset class="grid grid-cols-3 gap-6 p-4">
					<div class="grid grid-cols-6 gap-4 col-span-full lg:col-span-3">
						<div class="col-span-full sm:col-span-3">
							<label for="name" class="text-sm">Nome Completo</label>
							<input id="name" name="name" type="text" class="w-full p-2 rounded-md focus:ring focus:ri text-gray-900 border-gray-300 focus:ri" required>
						</div>
						<div class="col-span-full sm:col-span-2">
							<label for="email" class="text-sm">Email</label>
							<input id="email" name="email" type="email" class="w-full p-2 rounded-md focus:ring focus:ri text-gray-900 border-gray-300 focus:ri" required>
						</div>
						<div class="col-span-full sm:col-span-1">
							<label for="cpf" class="text-sm">CPF</label>
							<input id="cpf" name="cpf" type="text" class="w-full p-2 rounded-md focus:ring focus:ri text-gray-900 border-gray-300 focus:ri" required>
						</div>
						{% csrf_token %}
						<div class="col-span-full">
							<button type="" class="px-8 py-3 font-semibold rounded bg-gray-100 text-gray-800">Limpar</button>
							<button type="submit" class="px-8 py-3 font-semibold rounded bg-gray-800 text-gray-100">Adicionar Aluno</button>
						</div>
					</div>
				</fieldset>
			</form>
			<div class="px-8 py-3">
				<ul>
					{% for student in course.students.all %}
						<li>{{student.id}} - {{student.cpf}}: {{student.name}} <{{student.email}}>
							<button></button>
							(<a href="/student/{{student.id}}">excluir</a>)
						</li>

					{% empty %}
						<li>Ainda não há estudantes matriculados.</li>
					{% endfor %}
				</ul>
				<!-- <div class="absolute top-0 left-0 bottom-0 w-full overflow-auto flex flex-row gap-2 py-2 flex-wrap space-between">
				</div>  -->
			</div>
		</div>
	</div>
</div>
{% endblock %}